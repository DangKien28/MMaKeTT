<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>{{ p.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <h1>üõçÔ∏è MMK Market</h1>
            <nav>
                <a href="/" class="nav-link">Quay l·∫°i Mua S·∫Øm</a>
                <a href="/cart" class="nav-link">üõí Gi·ªè H√†ng</a>
            </nav>
        </div>
    </header>

    <main class="container detail-page">
        <!-- Ph·∫ßn tr√™n: ·∫¢nh & Th√¥ng tin mua h√†ng -->
        <div class="product-main">
            <!-- C·ªôt tr√°i: ·∫¢nh & Video -->
            <div class="product-gallery">
                <div class="main-image-container">
                    <img id="main-img" src="{{ p.images[0] }}" alt="{{ p.name }}" onmousemove="zoomImage(event)" onmouseleave="resetZoom()">
                </div>
                <div class="thumbnail-list">
                    {% for img in p.images %}
                    <img src="{{ img }}" onclick="changeImage('{{ img }}')" class="thumb-img">
                    {% endfor %}
                    
                    {% if p.video %}
                    <div class="video-btn" onclick="toggleVideo()">üé• Video</div>
                    {% endif %}
                </div>
                
                <div id="video-box" class="hidden video-container">
                    <iframe width="100%" height="300" src="{{ p.video }}" frameborder="0" allowfullscreen></iframe>
                </div>
            </div>

            <!-- C·ªôt ph·∫£i: Th√¥ng tin & N√∫t mua -->
            <div class="product-info-col">
                <h1 class="p-title">{{ p.name }}</h1>
                <div class="p-meta">
                    <span>Th∆∞∆°ng hi·ªáu: {{ p.vendor }}</span> | 
                    <span>ƒê√°nh gi√°: {{ p.rating_avg }} ‚≠ê</span> | 
                    <span>ƒê√£ b√°n: 1.2k</span>
                </div>
                <div class="p-price">{{ "{:,.0f}".format(p.price) }} ƒë</div>

                <!-- Ch·ªçn bi·∫øn th·ªÉ (Code ƒë√£ s·ª≠a l·∫°i cho d·ªÖ ƒë·ªçc h∆°n) -->
                {% if p.variants %}
                <div class="variant-area">
                    <p><strong>Ch·ªçn ph√¢n lo·∫°i:</strong></p>
                    <div id="detail-variants">
                        {% for v in p.variants %}
                            <!-- Ki·ªÉm tra t·ªìn kho b·∫±ng if block r√µ r√†ng -->
                            <button class="variant-btn {% if v.stock <= 0 %}disabled{% endif %}" 
                                    onclick="selectDetailVariant('{{ v.id }}', this, {{ v.stock }})"
                                    {% if v.stock <= 0 %}disabled{% endif %}>
                                {{ v.name }}
                            </button>
                        {% endfor %}
                    </div>
                    <div id="detail-stock" style="margin-top:10px; color:green; font-weight:bold"></div>
                </div>
                {% endif %}

                <div class="action-area">
                    <input type="number" id="detail-qty" value="1" min="1" max="10" style="width: 60px; padding: 10px;">
                    <button class="action-btn primary" onclick="addToCartFromDetail('{{ p.id }}')">TH√äM V√ÄO GI·ªé</button>
                </div>

                {% if p.shop %}
                <div class="shop-card">
                    <img src="{{ p.shop.avatar }}" class="shop-avatar">
                    <div>
                        <strong>{{ p.shop.name }}</strong>
                        <p>ƒê√°nh gi√° shop: {{ p.shop.rating }}/5</p>
                    </div>
                    <button class="action-btn secondary" style="margin-left:auto; font-size:12px">Xem Shop</button>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Ph·∫ßn d∆∞·ªõi: M√¥ t·∫£ & ƒê√°nh gi√° -->
        <div class="product-details-bottom">
            <div class="section-box">
                <h3>Chi Ti·∫øt S·∫£n Ph·∫©m</h3>
                <div class="p-desc">{{ p.description }}</div>
                {% if p.attributes %}
                <table class="attr-table">
                    {% for attr in p.attributes %}
                    <tr>
                        <td class="attr-name">{{ attr.name }}</td>
                        <td>{{ attr.value }}</td>
                    </tr>
                    {% endfor %}
                </table>
                {% endif %}
            </div>

            <div class="section-box">
                <h3>ƒê√°nh Gi√° S·∫£n Ph·∫©m</h3>
                {% if p.reviews %}
                    {% for rev in p.reviews %}
                    <div class="review-item">
                        <div class="rev-header">
                            <strong>{{ rev.user }}</strong>
                            <span class="rev-stars">{{ '‚≠ê' * rev.rating }}</span>
                        </div>
                        <p class="rev-content">{{ rev.comment }}</p>
                        <span class="rev-date">{{ rev.date }}</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>Ch∆∞a c√≥ ƒë√°nh gi√° n√†o.</p>
                {% endif %}
            </div>
        </div>
    </main>
    
    <div id="toast" class="toast hidden">Th√™m th√†nh c√¥ng!</div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Set bi·∫øn to√†n c·ª•c cho JS d√πng
        const currentDetailProductId = "{{ p.id }}";
        
        // S·ª≠a l·∫°i c√∫ ph√°p ki·ªÉm tra bi·∫øn th·ªÉ ƒë·ªÉ tr√°nh l·ªói JS
        // N·∫øu p.variants t·ªìn t·∫°i (Python list kh√¥ng r·ªóng) -> in ra true (JS boolean)
        // Ng∆∞·ª£c l·∫°i -> in ra false
        const hasVariants = {{ 'true' if p.variants else 'false' }};
    </script>
</body>
</html>